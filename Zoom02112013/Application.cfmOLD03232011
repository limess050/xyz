<!--- Set application scope and turn on session management. 
	Applications on the same server must have unique names. --->
<cfapplication name="DARSite" sessionManagement="Yes" scriptprotect="all"> 
<!--- Set error handling --->
<cferror type="exception" template="Lighthouse/Admin/error.cfm" mailto="douglas@modernsignal.com"> 
<cferror type="request" template="Lighthouse/Admin/error-request.cfm">

<cfinclude template="Lighthouse/SQLInjectionModule.cfm">

<!------------------------------------------------------------>
<!--- set standard Lighthouse variables ---------------------->
<!------------------------------------------------------------>

<!--- Table prefix for standard Lighthouse tables. --->
<cfset Request.dbprefix="LH">
<!--- ColdFusion datasource name --->
<cfset Request.dsn="DAR">
<!--- Type of database.  (mysql or mssql (SQL Server).  Default is mssql) --->
<cfset Request.dbtype="mssql">
<!--- Username and password for database. --->
<cfset Request.dbusername="">
<cfset Request.dbpassword="">
<!--- 
Auth Type used for accessing password protected RSS feeds.  Can be "basic" or "auto".
Use basic authentication if possible.  In IIS, basic and NT authentication must be turned off
so that ColdFusion can handle the authentication. 
--->
<cfset Request.lh_authType = "basic">

<!--- Set whether friendly urls will be used.  If true, then the web server must be set up to 
	use /404.cfm to handle all 404 errors. --->
<cfset Request.lh_useFriendlyUrls = true>

<!--- Override any standard tablenames, if necessary. --->
<!---<cfset MCFDBUsersTableName = "#Request.dbprefix#_AdminUsers">--->
<!--- Path from webserver root to application root. Include leading "/" (e.g. "/subdir"). Leave blank if application is at webserver root. --->
<cfset Request.AppVirtualPath = "">
<!--- Path from webserver root to directory where files will be uploaded.  Do NOT include leading "/" --->
<cfset Request.MCFUploadsDir = "uploads">
<!--- Stylesheet to use for Lighthouse admin screens. Available stylesheets are in Lighthouse/Resources/css --->
<cfset Request.MCFStyle = "MSStandard">

<!--- Fully qualified paths to non-secure and secure applications. If secure does not exist, use same value as non-secure. --->

<!--- <cfset Request.httpURL = "http://www.EverythingDAR.com"> 
<cfset Request.httpsURL = "https://www.EverythingDAR.com"> --->
<cfset Request.httpURL = "http://www.everythingDAR.com"> 
<cfset Request.httpsURL = "http://www.everythingDAR.com">
<cfset Request.environment="Live">
<!--- Global title of application --->
<cfset Request.glb_title = "DAR"> 
<!--- Include Libraries --->
<cfinclude template="Lighthouse/Functions/Init.cfm">
<cfinclude template="Lighthouse/Functions/LighthouseLib.cfm">

<cfset Request.MailToFormsTo = "accounts@everythingDAR.com">
<cfset Request.MailToFormsFrom = "inquiry@everythingDAR.com">
<cfset Request.DevelCCEmail = "">

<cfset Request.ListingImagesDir = "c:/sites/DAR/web/ListingImages">
<cfset Request.ListingUploadedDocsDir = "c:/sites/DAR/web/ListingUploadedDocs">

<cfset Request.BannerAdsUploadedDocsDir = "c:/sites/DAR/web/uploads/BannerAds">

<cfset Request.AddAListingPageID="5">
<cfset Request.RenwalCartPageID="16">
<cfset Request.AddABannerAdPageID="21">
<cfset Request.SectionOverviewPageID="29">
<cfset Request.NonAcctRenewalPageID="30">
<cfset Request.SearchEventsPageID="33">
<cfset Request.JobSeekersGuidePageID="38">

<cfset Application.LoginTemplate="templates/login.cfm">

<!--- Set parameters for devel, staging, etc, environments. --->
<cfswitch expression="#cgi.SERVER_NAME#">
	<!--- Douglas' Local Envi OR DAR Laptop --->
	<cfcase value="127.0.0.1"> 
		<cfif CGI.SCRIPT_NAME contains "DAR/Web"><!--- Douglas --->
			<cfset Request.dsn="DAROnDevel">
			<cfset Request.dbusername="">
			<cfset Request.dbpassword="">
			<cfset Request.httpURL = "http://127.0.0.1/DAR/Web">
			<cfset Request.httpsURL = "http://127.0.0.1/DAR/Web">
			<cfset Request.environment="DB">
			<cfset Request.AppVirtualPath = "/DAR/web/">
			<!--- Password protect entire site --->
			<cfif CGI.SCRIPT_NAME does not contain "inttasks"><!--- exception for Synching calls --->
				<cfinclude template="Lighthouse/Admin/checkQaLogin.cfm">
			</cfif>
			<cfset request.MCFUploadsDir = "DAR/web/uploads">
			<!--- Set error handling for local environment -- show error but don't send email --->
			<cfset Request.lh_showErrorInfo = true>
			<cfset Request.lh_sendErrorEmail = false>
			<cfset Request.lh_useFriendlyUrls = false>
			<cfset Request.MailToFormsTo = "douglas@modernsignal.com">
			<cfset Request.MailToFormsFrom = "douglas@modernsignal.com">
			<cfset Request.DevelCCEmail = "douglas@modernsignal.com">
			<cfset Request.ListingImagesDir = "c:/inetpub/wwwroot/DAR/web/ListingImages">
			<cfset Request.ListingUploadedDocsDir = "c:/inetpub/wwwroot/DAR/web/ListingUploadedDocs">
			<cfset Request.SectionOverviewPageID="30">
			<cfset Request.NonAcctRenewalPageID="31">
		<cfelse>
			<cfset Request.dsn="DAR">
			<cfset Request.dbusername="">
			<cfset Request.dbpassword="">
			<cfset Request.httpURL = "http://localhost">
			<cfset Request.httpsURL = "http://localhost">
			<cfset Request.environment="LT">
			<cfset Request.AppVirtualPath = "">
			<cfset request.MCFUploadsDir = "uploads">
			<!--- Set error handling for local environment -- show error but don't send email --->
			<cfset Request.lh_showErrorInfo = true>
			<cfset Request.lh_sendErrorEmail = false>
			<cfset Request.lh_useFriendlyUrls = true>
			<cfset Request.MailToFormsTo = "douglas@modernsignal.com">
			<cfset Request.MailToFormsFrom = "douglas@modernsignal.com">
			<cfset Request.DevelCCEmail = "douglas@modernsignal.com">
			<cfset Request.ListingImagesDir = "c:/inetpub/wwwroot/ListingImages">
			<cfset Request.ListingUploadedDocsDir = "c:/inetpub/wwwroot/ListingUploadedDocs">
		</cfif>
	</cfcase>	
	<!--- Laptop Local Envi --->
	<cfcase value="localhost"> 
		<cfset Request.dsn="DAR">
		<cfset Request.dbusername="">
		<cfset Request.dbpassword="">
		<cfset Request.httpURL = "http://localhost">
		<cfset Request.httpsURL = "http://localhost">
		<cfset Request.environment="LT">
		<cfset Request.AppVirtualPath = "">
		<cfset request.MCFUploadsDir = "uploads">
		<!--- Set error handling for local environment -- show error but don't send email --->
		<cfset Request.lh_showErrorInfo = true>
		<cfset Request.lh_sendErrorEmail = false>
		<cfset Request.lh_useFriendlyUrls = true>
		<cfset Request.MailToFormsTo = "douglas@modernsignal.com">
		<cfset Request.MailToFormsFrom = "douglas@modernsignal.com">
		<cfset Request.DevelCCEmail = "douglas@modernsignal.com">
		<cfset Request.ListingImagesDir = "c:/inetpub/wwwroot/ListingImages">
		<cfset Request.ListingUploadedDocsDir = "c:/inetpub/wwwroot/ListingUploadedDocs">
	</cfcase>	
	<!--- Development server --->
	<cfcase value="DAR.modernsignal.net"> 
		<cfset Request.httpURL = "http://DAR.modernsignal.net">
		<cfset Request.httpsURL = "http://DAR.modernsignal.net">
		<cfset Request.environment="Devel">
		<!--- Password protect entire site --->
		<cfif CGI.SCRIPT_NAME does not contain "inttasks"><!--- exception for Synching calls --->
			<cfinclude template="Lighthouse/Admin/checkQaLogin.cfm">
		</cfif>
		<!--- Set error handling for local environment -- show error but don't send email --->
		<cfset Request.lh_showErrorInfo = true>
		<cfset Request.lh_sendErrorEmail = true>
		<cfset Request.MailToFormsTo = "eleanor@modernsignal.com">
		<cfset Request.MailToFormsFrom = "dar@modernsignal.com">
		<cfset Request.DevelCCEmail = "douglas@modernsignal.com,eleanor@modernsignal.com">
		<cfset Request.SectionOverviewPageID="30">
		<cfset Request.NonAcctRenewalPageID="31">
	</cfcase>	
</cfswitch>

<!--- Initialize the application.  Add lh_Initialize=1 to url to re-initialize at any time. --->
<cfif Not ApplicationIsInitialized()>
<cfset Application.GoogleAnalyticsAcctNum = ""> 
	<cfset InitializeApplication()>
<!--- Override application defaults, if necessary. See Functions/Init.cfm for the default values. --->
	<!--- <cfsavecontent variable="Application.ErrorMessage"></cfsavecontent> --->
</cfif>

<!--- admin-specific variables and settings --->
<!--- Admin pages are assumed to be all admin pages within /admin directory. --->
<cfif FindNoCase("/admin/",cgi.script_name)>
	<!--- Check for secure connection --->
	<cfinclude template="Lighthouse/Admin/checkssl.cfm">
	<!--- Make sure user is logged in --->
	<cfinclude template="Lighthouse/Admin/checklogin.cfm">
</cfif>

<!------------------------------------------>
<!--- Set application-specific variables --->
<!------------------------------------------>

<cfif Request.lh_useFriendlyUrls>
	<cfset AmpOrQuestion="?">
<cfelse>
	<cfset AmpOrQuestion="&">
</cfif>

<cfset request.RowsPerPage="50">
<cfset request.LinksPerPage="12">
<cfset request.MaxSearchResults="10">

<!--- Force user to be on 'www' url --->
<cfif Request.environment is "live">
	<!--- set up the getRequest method for easy access --->
	<cfset PageRequestData = getPageContext().getRequest() />
 	<cfset ServerName=PageRequestData.getServerName()>
	<cfif not ServerName contains "www">
		<cfset ServerName="www." & ServerName>	
		<cfif PageRequestData.getRequestURI() is "/Lighthouse/404.cfm">
			<cfset PageRequested=REReplace(PageRequestData.getQueryString(),"404;https?://[^/]+","")>
			<cfset PageRequestQueryString="">
		<cfelse>
			<cfset PageRequested=PageRequestData.getRequestURI()>
			<cfif Len(PageRequestData.getQueryString())>
				<cfset PageRequestQueryString="?" & PageRequestData.getQueryString()>
			<cfelse>
				<cfset PageRequestQueryString="">
			</cfif>
		</cfif>
		<cfif PageRequestData.isSecure()>
			<cflocation url="https://#ServerName##PageRequested##PageRequestQueryString#" addToken="false">
		<cfelse>
			<cflocation url="http://#ServerName##PageRequested##PageRequestQueryString#" addToken="false">
		</cfif>
	</cfif>	
</cfif>

